{% extends 'admin2/base2.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/menuitem.css' %}">
<h2>Add Menu Item</h2>

<!-- Add Category Button -->
<button id="add-category-btn" onclick="openCategoryModal()">+ Add Category</button>

<!-- Modal for Add Category -->
<div id="categoryModal" style="display:none;">
    <div class="modal-content">
        <button class="close" onclick="closeCategoryModal()">âœ•</button>
        <h3 style="text-align: center;padding: 8px 16px;">Categories</h3>
        <ul>
            {% for category in categories %}
                <li>
                    <strong>{{ category.name }}</strong>
                    {% if category.description %}
                        <br><small>{{ category.description }}</small>
                    {% endif %}
                    <br><small>Added by: {{ category.added_by }}</small>
                </li>
            {% empty %}
                <li>No categories found.</li>
            {% endfor %}
        </ul>
        <hr>
        <h4>Add New Category</h4>
        <form method="POST" action="{% url 'category_create' %}">
            {% csrf_token %}
            <label for="category_name">Category Name:</label>
            <input type="text" name="category_name" id="category_name" required>
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" required>
            <button type="submit" style="margin-top: 15px;">Add Category</button>
        </form>
    </div>
</div>

<!-- Add Menu Item Form -->
<form method="POST" enctype="multipart/form-data" action="{% url 'menuitem_list' %}">
    {% csrf_token %}
    {% if error_message %}
        <div style="color: red;">{{ error_message }}</div>
    {% endif %}
    {{ form.non_field_errors }}
    <div>
        {{ form.category.label_tag }} {{ form.category }}
        {{ form.category.errors }}
    </div>
    <div>
        {{ form.name.label_tag }} {{ form.name }}
        {{ form.name.errors }}
    </div>
    <div>
        {{ form.description.label_tag }} {{ form.description }}
        {{ form.description.errors }}
    </div>
    <div>
        {{ form.price.label_tag }} {{ form.price }}
        {{ form.price.errors }}
    </div>
    <div>
        {{ form.image.label_tag }} {{ form.image }}
        {{ form.image.errors }}
    </div>
    <button type="submit">Add Menu Item</button>
</form>

<!-- Display Menu Items by Category -->
{% for category, items in menuitems_by_category.items %}
    <div>
        <h2 class="category-title">{{ category.name }}</h2>
        <table class="category-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price (CHF)</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.price }}</td>
                    <td>
                        {% if item.image %}
                            <img src="{{ item.image.url }}" alt="{{ item.name }}" style="max-width:80px;max-height:80px;">
                        {% else %}
                            No image
                        {% endif %}
                    </td>
                    <td class="action-buttons">
                        <!-- View Button -->
                        <a href="{% url 'menuitem_view' item.id %}">
                            <button class="btn-view" type="button">View</button>
                        </a>
                        <!-- Edit Button -->
                        <a href="{% url 'menuitem_update' item.id %}">
                            <button class="btn-edit" type="button">Edit</button>
                        </a>
                        <!-- Delete Button -->
                        <form method="POST" action="{% url 'menuitem_delete' item.id %}" style="display:inline-block; width: 70px; padding: 0;">
                            {% csrf_token %}
                            <button class="btn-edit" type="submit" onclick="return confirm('Delete this item?')">Delete</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No items in this category.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endfor %}

<script>
    function openCategoryModal() {
        document.getElementById('categoryModal').style.display = 'block';
    }
    function closeCategoryModal() {
        document.getElementById('categoryModal').style.display = 'none';
    }
</script>
{% endblock %}